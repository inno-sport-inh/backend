# –§–∏–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ API

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –≤—ã–≤–æ–¥—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–≤ –≤–∞—à –ø—Ä–æ–µ–∫—Ç, —è —Å–æ–∑–¥–∞–ª –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –ø–ª–∞–Ω —Ä–µ–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ API –≤ —Å—Ç–∏–ª–µ REST. –í–æ—Ç —á—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:

## üìã –ß—Ç–æ —É–∂–µ –≥–æ—Ç–æ–≤–æ

‚úÖ **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ ViewSet'–æ–≤** - —Å–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `api/viewsets.py` —Å –±–∞–∑–æ–≤—ã–º–∏ ViewSet'–∞–º–∏  
‚úÖ **URL –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è** - –Ω–∞—Å—Ç—Ä–æ–µ–Ω `api-v2/urls.py` —Å DRF Router  
‚úÖ **Middleware –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è** - —Å–æ–∑–¥–∞–Ω `api/middleware.py` –¥–ª—è deprecation tracking  
‚úÖ **–°–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è URL'–æ–≤ –≤ –∫–æ–¥–µ  
‚úÖ **–¢–µ—Å—Ç—ã** - –ø—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –Ω–æ–≤–æ–≥–æ API  
‚úÖ **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** - –ø–æ–¥—Ä–æ–±–Ω—ã–π –ø–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏  

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–≤ –ø–æ—Ä—è–¥–∫–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞)

### 1. –ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è –ª–æ–≥–∏–∫–∏ –≤ ViewSet'–∞—Ö (–ö—Ä–∏—Ç–∏—á–Ω–æ)
```python
# –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –ª–æ–≥–∏–∫—É –∏–∑ api/views/ –≤ api/viewsets.py
# –ù–∞—á–Ω–∏—Ç–µ —Å —Å–∞–º—ã—Ö –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤:
- ProfileViewSet.student_info()        # –∏–∑ api/views/profile.py
- EnrollmentViewSet.enroll()          # –∏–∑ api/views/enroll.py  
- GroupViewSet.sports()               # –∏–∑ api/views/group.py
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ middleware (–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
```python
# –í settings.py added:
MIDDLEWARE = [
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ ...
    'api.middleware.APIDeprecationMiddleware',
    'api.middleware.APIMetricsMiddleware',
]
```

### 3. –ê–∫—Ç–∏–≤–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ API (–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
```python
# –í adminpage/urls.py —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ:
path("api/v2/", include("api-v2.urls")),
```

### 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã –Ω–æ–≤–æ–≥–æ API
python manage.py test api.tests.test_api_v2

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
curl http://localhost:8000/api/v2/profile/student/
```

## üîÑ –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π

### –ù–µ–¥–µ–ª—è 1: –ë–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
1. **–ó–∞–≤–µ—Ä—à–∏—Ç—å ProfileViewSet**
   - –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –ª–æ–≥–∏–∫—É `get_student_info`
   - –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ `toggle_QR_presence`
   - –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ `change_gender`

2. **–ó–∞–≤–µ—Ä—à–∏—Ç—å EnrollmentViewSet** 
   - –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –ø–æ–ª–Ω—É—é –ª–æ–≥–∏–∫—É –∏–∑ `api/views/enroll.py`
   - –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –∏ –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫
   - –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å enrollment workflow

### –ù–µ–¥–µ–ª—è 2: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
1. **–ó–∞–≤–µ—Ä—à–∏—Ç—å GroupViewSet –∏ TrainingViewSet**
2. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å middleware –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
3. **–°–æ–∑–¥–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é API —á–µ—Ä–µ–∑ Swagger**

### –ù–µ–¥–µ–ª—è 3: –ú–∏–≥—Ä–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤
1. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è frontend –∫–æ–¥–∞**
2. **–û–±–Ω–æ–≤–∏—Ç—å –º–æ–±–∏–ª—å–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–µ—Å–ª–∏ –µ—Å—Ç—å)**
3. **–î–æ–±–∞–≤–∏—Ç—å deprecation warnings –≤ —Å—Ç–∞—Ä–æ–µ API**

### –ù–µ–¥–µ–ª—è 4: –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è
1. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å—Ç–∞—Ä–æ–≥–æ API**
2. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º**
3. **–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç–∞—Ä–æ–≥–æ API**

## üõ† –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –Ω–∞—á–∞–ª–∞

### 1. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
```bash
cd /Users/an11y/Downloads/backend-API-V2/adminpage

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –Ω–æ–≤—ã–µ URL'—ã —Ä–∞–±–æ—Ç–∞—é—Ç
python manage.py runserver
# –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ http://localhost:8000/api/v2/docs

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é URL'–æ–≤ (dry run)
python ../scripts/migrate_api_urls.py . --dry-run --report migration_report.txt
```

### 2. –ü–µ—Ä–≤–∞—è –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è
```python
# –í api/viewsets.py –∑–∞–º–µ–Ω–∏—Ç–µ TODO –Ω–∞ —Ä–µ–∞–ª—å–Ω—É—é –ª–æ–≥–∏–∫—É:
def student_info(self, request):
    # –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏–∑ api/views/profile.py:get_student_info
    student: Student = request.user.student
    serializer = StudentSerializer(student)
    return Response(serializer.data)
```

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç
curl -H "Authorization: Bearer YOUR_TOKEN" \
     http://localhost:8000/api/v2/profile/student/
```

## üìä –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞
- **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–µ URL'—ã**: `/api/v2/resource/action/` –≤–º–µ—Å—Ç–æ `/api/resource/action`
- **–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ HTTP –º–µ—Ç–æ–¥—ã**: –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ GET/POST/PUT/DELETE
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: Swagger UI –∏–∑ –∫–æ—Ä–æ–±–∫–∏
- **–õ—É—á—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: ViewSet'—ã —Å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏

### –ë–∏–∑–Ω–µ—Å –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞  
- **–ü—Ä–æ—Å—Ç–æ—Ç–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏**: —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤ ViewSet'–∞—Ö
- **–ë—ã—Å—Ç—Ä–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞**: –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è URL'–æ–≤ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- **–õ—É—á—à–∏–π DX**: –ø–æ–Ω—è—Ç–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è frontend —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—é –Ω–æ–≤—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤

## ‚ö†Ô∏è –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞: –°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤ —Å—Ç–∞—Ä—ã—Ö views
**–†–µ—à–µ–Ω–∏–µ**: –ü–æ—ç—Ç–∞–ø–Ω—ã–π –ø–µ—Ä–µ–Ω–æ—Å, –Ω–∞—á–∏–Ω–∞—è —Å –ø—Ä–æ—Å—Ç—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤

### –ü—Ä–æ–±–ª–µ–º–∞: –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
**–†–µ—à–µ–Ω–∏–µ**: –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –æ–±–µ–∏—Ö –≤–µ—Ä—Å–∏–π API + –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è URL'–æ–≤

### –ü—Ä–æ–±–ª–µ–º–∞: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è –ø–æ —á–∞—Å—Ç–æ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è + –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã

## üéì –ü—Ä–∏–º–µ—Ä—ã URL —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏

```javascript
// –°–¢–ê–†–û–ï API (–Ω–µ–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ)
GET  /api/profile/student           ‚Üí GET  /api/v2/profile/student/
POST /api/enrollment/enroll         ‚Üí POST /api/v2/enrollment/enroll/
GET  /api/group/123                 ‚Üí GET  /api/v2/group/123/
POST /api/training/123/check_in     ‚Üí POST /api/v2/training/123/check-in/

// –£–ª—É—á—à–µ–Ω–∏—è:
// ‚úÖ –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–µ trailing slashes
// ‚úÖ Kebab-case –≤–º–µ—Å—Ç–æ snake_case –≤ URL
// ‚úÖ –õ–æ–≥–∏—á–µ—Å–∫–∞—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤
// ‚úÖ –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ REST –ø–∞—Ç—Ç–µ—Ä–Ω—ã
```

## üéØ –ò–∑–º–µ—Ä–∏–º—ã–µ —Ü–µ–ª–∏

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏ —É –≤–∞—Å –±—É–¥–µ—Ç:
- **100% REST-compliant API** —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ HTTP –º–µ—Ç–æ–¥–∞–º–∏
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** —á–µ—Ä–µ–∑ OpenAPI/Swagger
- **–£–ª—É—á—à–µ–Ω–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** –∑–∞ —Å—á–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö ViewSet'–æ–≤
- **–õ—É—á—à–∞—è –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å** –∫–æ–¥–∞
- **–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é** –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

–ù–∞—á–Ω–∏—Ç–µ —Å –ø–µ—Ä–≤–æ–≥–æ —à–∞–≥–∞ - –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏–∏ ProfileViewSet –∏ EnrollmentViewSet, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∏ –Ω–∞–∏–±–æ–ª–µ–µ –∫—Ä–∏—Ç–∏—á–Ω—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π! üöÄ
